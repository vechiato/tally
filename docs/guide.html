<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guide - Tally</title>
    <meta name="description" content="Learn how to use Tally with AI assistants like Claude Code, GitHub Copilot, and Codex to automatically categorize your transactions.">
    <link rel="icon" type="image/svg+xml" href="logo.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Page-specific styles for Guide */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 3rem 2rem 5rem;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 50%, #16a34a 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: rgba(255,255,255,0.6);
            font-size: 1.1rem;
            margin-bottom: 3rem;
        }

        h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #fff;
            margin: 2.5rem 0 1rem;
            padding-top: 1rem;
        }

        h2:first-of-type {
            margin-top: 0;
        }

        h3 {
            font-size: 1rem;
            font-weight: 600;
            color: rgba(255,255,255,0.9);
            margin: 1.5rem 0 0.75rem;
        }

        p {
            color: rgba(255,255,255,0.8);
            margin-bottom: 1rem;
        }

        pre {
            background: #0d0d0d;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 1rem 1.25rem;
            overflow-x: auto;
            margin: 1rem 0 1.5rem;
        }

        code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }

        pre code {
            color: #e0e0e0;
        }

        p code {
            background: rgba(255,255,255,0.1);
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .cmd::before {
            content: '$ ';
            color: #4ade80;
        }

        .output {
            color: rgba(255,255,255,0.6);
        }

        ul, ol {
            margin: 1rem 0 1.5rem 1.5rem;
            color: rgba(255,255,255,0.8);
        }

        li {
            margin-bottom: 0.5rem;
        }

        a {
            color: #4ade80;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        h2[id], h3[id] {
            position: relative;
        }

        h2[id] .anchor-link, h3[id] .anchor-link {
            position: absolute;
            left: -1.5rem;
            color: rgba(255,255,255,0.3);
            text-decoration: none;
            opacity: 0;
            transition: opacity 0.2s;
            font-weight: 400;
        }

        h2[id]:hover .anchor-link, h3[id]:hover .anchor-link {
            opacity: 1;
        }

        h2[id] .anchor-link:hover, h3[id] .anchor-link:hover {
            color: #4ade80;
            text-decoration: none;
        }

        .user-msg {
            background: rgba(74, 222, 128, 0.1);
            border-left: 3px solid #4ade80;
            padding: 0.75rem 1rem;
            margin: 1rem 0;
            font-style: italic;
            color: rgba(255,255,255,0.9);
        }

        .agent-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0 1.5rem;
        }

        .agent-item {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 8px;
            padding: 1rem;
        }

        .agent-item strong {
            color: #fff;
            display: block;
            margin-bottom: 0.25rem;
        }

        .agent-item span {
            color: rgba(255,255,255,0.5);
            font-size: 0.85rem;
        }

        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .container { padding: 2rem 1.5rem 3rem; }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-inner">
            <a href="index.html" class="nav-logo"><img src="logo.svg" alt="Tally">tally</a>
            <div class="hamburger" onclick="this.classList.toggle('active'); document.querySelector('.nav-links').classList.toggle('active')">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="nav-links">
                <span class="close-menu" onclick="document.querySelector('.nav-links').classList.remove('active'); document.querySelector('.hamburger').classList.remove('active')">&times;</span>
                <a href="quickstart.html">Quick Start</a>
                <a href="guide.html" class="active">Guide</a>
                <a href="reference.html">Reference</a>
                <a href="formats.html">Formats</a>
                <a href="https://github.com/davidfowl/tally" class="mobile-github" style="display:none;">GitHub</a>
            </div>
            <a href="https://github.com/davidfowl/tally" class="nav-github">GitHub</a>
        </div>
    </nav>

    <div class="container">
        <h1>Guide</h1>
        <p class="subtitle">Using Tally with AI assistants</p>

        <h2 id="how-it-works"><a href="#how-it-works" class="anchor-link">#</a>How It Works</h2>
        <p>Tally is a <strong>rule engine</strong> that classifies transactions. The AI assistant is the <strong>operator</strong> that writes the rules. Together they create a feedback loop:</p>
        <ol>
            <li>Tally finds uncategorized transactions</li>
            <li>AI identifies the merchants and writes categorization rules</li>
            <li>Tally applies rules and finds remaining unknowns</li>
            <li>Repeat until everything is categorized</li>
        </ol>

        <h2 id="supported-ai-assistants"><a href="#supported-ai-assistants" class="anchor-link">#</a>Supported AI Assistants</h2>
        <div class="agent-list">
            <div class="agent-item">
                <strong>Claude Code</strong>
                <span>Anthropic CLI</span>
            </div>
            <div class="agent-item">
                <strong>GitHub Copilot</strong>
                <span>VS Code / CLI</span>
            </div>
            <div class="agent-item">
                <strong>Codex</strong>
                <span>OpenAI CLI</span>
            </div>
            <div class="agent-item">
                <strong>Cursor</strong>
                <span>AI IDE</span>
            </div>
        </div>
        <p>Any AI agent that can run command-line tools will work with Tally.</p>

        <h2 id="starting-a-session"><a href="#starting-a-session" class="anchor-link">#</a>Starting a Session</h2>
        <p>After <a href="quickstart.html">setting up your budget folder</a>, open it in your AI assistant and tell it what to do:</p>

        <div class="user-msg">"Use tally to configure my Chase credit card CSV"</div>
        <div class="user-msg">"Use tally to categorize all my transactions"</div>
        <div class="user-msg">"Use tally to generate my spending report"</div>

        <p>The agent will run <code>tally workflow</code> to understand the current state and follow the instructions.</p>

        <h2 id="workflow-command"><a href="#workflow-command" class="anchor-link">#</a>The Workflow Command</h2>
        <p>The <code>tally workflow</code> command is context-aware. It detects your setup state and shows relevant next steps:</p>

        <h3>No data sources configured</h3>
        <pre><code><span class="cmd">tally workflow</span>
<span class="output">
No data sources configured yet.

To add a data source:
1. Run: tally inspect data/yourfile.csv
2. Add the suggested config to settings.yaml
</span></code></pre>

        <h3>Unknown merchants found</h3>
        <pre><code><span class="cmd">tally workflow</span>
<span class="output">
Found 47 unknown merchants.

Run: tally discover --format json
Then add rules to config/merchants.rules
</span></code></pre>

        <h3>Ready to generate report</h3>
        <pre><code><span class="cmd">tally workflow</span>
<span class="output">
All transactions categorized!

Run: tally up
</span></code></pre>

        <h2 id="key-commands"><a href="#key-commands" class="anchor-link">#</a>Key Commands for AI Agents</h2>

        <h3>Discover unknown merchants</h3>
        <pre><code><span class="cmd">tally discover --format json</span></code></pre>
        <p>Returns uncategorized transactions with suggested patterns. The AI uses this to write rules.</p>

        <h3>Inspect CSV structure</h3>
        <pre><code><span class="cmd">tally inspect data/chase.csv</span></code></pre>
        <p>Analyzes CSV structure with column type detection (dates, currency, numbers, categorical). Shows samples for both positive and negative amounts to help understand sign conventions.</p>

        <h3>Explain a classification</h3>
        <pre><code><span class="cmd">tally explain Netflix -vv</span></code></pre>
        <p>Shows why a merchant is classified a certain way, including which rule matched. Supports combined filters:</p>
        <pre><code><span class="cmd">tally explain --category Food --month Jan</span>
<span class="cmd">tally explain --tags business --month 2025-01</span></code></pre>

        <h3>Debug configuration</h3>
        <pre><code><span class="cmd">tally diag --format json</span></code></pre>
        <p>Validates configuration and shows any errors.</p>

        <h3>Run full analysis</h3>
        <pre><code><span class="cmd">tally up --format json -v</span></code></pre>
        <p>Returns complete analysis with classification reasoning.</p>

        <h2 id="writing-rules"><a href="#writing-rules" class="anchor-link">#</a>Writing Rules</h2>
        <p>When the AI finds unknown transactions, it adds rules to <code>config/merchants.rules</code>:</p>
        <pre><code><span class="highlight">[Netflix]</span>
match: contains("NETFLIX")
category: Subscriptions
subcategory: Streaming
tags: entertainment, recurring

<span class="highlight">[Whole Foods]</span>
match: contains("WHOLEFDS") or contains("WHOLE FOODS")
category: Food
subcategory: Grocery</code></pre>

        <p>See the <a href="reference.html">Reference</a> for full syntax.</p>

        <h3 id="transforms"><a href="#transforms" class="anchor-link">#</a>Using Transforms</h3>
        <p>Add an optional <code>@transforms</code> block at the top of <code>merchants.rules</code> to pre-process rows before matching. Example: add a fee column to the transaction amount.</p>
        <pre><code><span class="highlight">@transforms</span>
<span class="comment"># Strip $/commas from fee, then add to amount</span>
field.amount = field.amount + regex_replace(regex_replace(field.fee, "\\$", ""), ",", "")

<span class="comment"># Clean descriptions</span>
field.description = regex_replace(field.description, "^APLPAY\\s+", "")</code></pre>

        <div class="callout">
            <div class="callout-title">Tip: Be specific with the AI</div>
            <p>Tell the AI your preferences: "Coffee shops should be Food > Coffee, not Food > Restaurant" or "Tag all Uber rides as business, reimbursable".</p>
        </div>

        <h2 id="customizing-categories"><a href="#customizing-categories" class="anchor-link">#</a>Customizing Categories</h2>
        <p>Tally doesn't have predefined categories. You define them in your rules:</p>
        <ul>
            <li><strong>Category</strong> - Primary grouping (Food, Transportation, Bills)</li>
            <li><strong>Subcategory</strong> - Secondary grouping (Grocery, Rideshare, Utilities)</li>
            <li><strong>Tags</strong> - Labels for filtering (business, reimbursable, recurring)</li>
        </ul>
        <p>Tell the AI your preferred structure and it will use it consistently.</p>

        <h2 id="generating-reports"><a href="#generating-reports" class="anchor-link">#</a>Generating Reports</h2>
        <p>Once transactions are categorized:</p>
        <pre><code><span class="cmd">tally up</span></code></pre>
        <p>This generates an HTML report with:</p>
        <ul>
            <li>Monthly spending breakdown</li>
            <li>Recurring expense detection</li>
            <li>Category summaries</li>
            <li>Transaction search and filtering</li>
        </ul>

        <h2 id="iterating"><a href="#iterating" class="anchor-link">#</a>Iterating</h2>
        <p>As you review the report, you might want changes:</p>
        <div class="user-msg">"Move Starbucks from Restaurant to Coffee"</div>
        <div class="user-msg">"Split Amazon purchases - anything over $100 should be Shopping > Electronics"</div>
        <div class="user-msg">"Tag all transactions in December as holiday"</div>

        <p>The AI updates the rules, and you can regenerate the report.</p>
    </div>
</body>
</html>
